"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{9361:function(e,t,n){n.d(t,{Z:function(){return r}});let l=async(e,t)=>{let n=await fetch("http://localhost:3253/api/execute_pg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queries:e})});if(!n.ok)throw Error("Failed to execute query");return await n.json()};class a{constructor(e){this.executeSQL=e=>new Promise((t,n)=>{l([e],this.id).then(e=>{var l,a;(null==e?void 0:null===(l=e.data)||void 0===l?void 0:l[0])?t(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a[0]):n(Error("Failed to execute query"))}).catch(n)}),this.getDBSchemas=()=>new Promise((e,t)=>{this.executeSQL("SELECT schema_name\n      FROM information_schema.schemata\n      WHERE \"schema_name\" NOT LIKE 'pg_%' AND schema_name <> 'information_schema';").then(n=>(null==n?void 0:n.rows)&&Array.isArray(null==n?void 0:n.rows)?e(null==n?void 0:n.rows.filter(e=>!!(null==e?void 0:e.schema_name)).map(e=>e.schema_name)):t(Error("Failed to parse the schemas"))).catch(t)}),this.getErdData=()=>new Promise((e,t)=>{this.executeSQL("SELECT\n      tc.table_schema,\n      tc.constraint_name,\n      tc.table_name,\n      kcu.column_name,\n      ccu.table_schema AS foreign_table_schema,\n      ccu.table_name AS foreign_table_name,\n      ccu.column_name AS foreign_column_name\n  FROM\n      information_schema.table_constraints AS tc\n      JOIN information_schema.key_column_usage AS kcu\n        ON tc.constraint_name = kcu.constraint_name\n        AND tc.table_schema = kcu.table_schema\n      JOIN information_schema.constraint_column_usage AS ccu\n        ON ccu.constraint_name = tc.constraint_name\n        AND ccu.table_schema = tc.table_schema;\n  ").then(t=>(console.log(t),e(t))).catch(t)}),this.getAllTables=e=>new Promise((t,n)=>{this.executeSQL("SELECT * FROM information_schema.tables\n      WHERE table_schema = '".concat(e,"'")).then(e=>(null==e?void 0:e.rows)&&Array.isArray(null==e?void 0:e.rows)?t(null==e?void 0:e.rows.filter(e=>!!(null==e?void 0:e.table_name))):n(Error("Failed to parse the schemas"))).catch(n)}),this.getTableData=e=>{let{schema:t,table:n,pagenumber:l=1,size:a=50,sortedColumns:r}=e;return new Promise((e,o)=>{let s='SELECT * FROM "'.concat(t,'"."').concat(n,'" ');r&&(s+=" ORDER BY "+Object.entries(r).map(e=>{let[t,n]=e;return"".concat(t," ").concat(n)}).join(",")),s+=" LIMIT ".concat(a," OFFSET ").concat((l-1)*a,";"),this.executeSQL(s).then(t=>e(t)).catch(o)})},this.getColumnNames=e=>{let{schema:t,table:n}=e;return new Promise((e,l)=>{let a="SELECT\n      column_name,\n      data_type\n    FROM\n      INFORMATION_SCHEMA.COLUMNS\n    WHERE\n      TABLE_NAME = '".concat(n,"'\n      AND table_schema = '").concat(t,"';");this.executeSQL(a).then(t=>e(t)).catch(l)})},this.id=e}}var r=a},427:function(e,t,n){n.d(t,{Z:function(){return j}});var l=n(7437),a=n(2265);let r=e=>{let{mode:t="none"}=e;return(0,l.jsx)("svg",{"aria-hidden":"true",role:"img",className:"octicon octicon-filter",viewBox:"0 0 16 16",width:"10",height:"10",fill:"currentColor",style:{transform:"rotate(".concat("desc"===t?"0":"180","deg)")},children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M.75 3a.75.75 0 000 1.5h14.5a.75.75 0 000-1.5H.75zM3 7.75A.75.75 0 013.75 7h8.5a.75.75 0 010 1.5h-8.5A.75.75 0 013 7.75zm3 4a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5a.75.75 0 01-.75-.75z"})})};r.defaultProps={mode:"none"};var o=n(5576),s=a.memo(e=>{let t,n,{value:a}=e;return a instanceof Date?t=new Date(a).toLocaleString():"object"==typeof a?(n=JSON.stringify(a,null,2),t=JSON.stringify(a)):(t=a,"string"==typeof a&&(null==a?void 0:a.length)>20&&(n=a)),(0,l.jsxs)("td",{className:"border-l border-b border-gray-600 px-2 break-all truncate text-white",style:{maxWidth:100},children:[(0,l.jsx)("span",{"data-tip":!0,"data-for":"btn-run-".concat(a),children:null!=t?t:""}),n&&(0,l.jsx)(o.Z,{id:"btn-run-".concat(a),type:"dark",children:(0,l.jsx)("pre",{className:"font-mono",style:{height:"40%"},children:n})})]})});let i=e=>{let{columnNames:t=[],tableData:n=[],selectedSchema:a="",selectedTable:o="",onSort:i=console.warn}=e,c=e=>{let n;let l=t[e];n=(null==l?void 0:l.sort)?(null==l?void 0:l.sort)==="asc"?"desc":"none":"asc",i({[null==l?void 0:l.column_name]:n})};return(0,l.jsxs)("table",{className:"w-full border border-gray-600",children:[(0,l.jsx)("tr",{className:"bg-gray-900",children:null==t?void 0:t.map((e,t)=>{let{visible:n=!0,column_name:a="",sort:o}=e;return n&&(0,l.jsxs)("th",{className:"border bg-gray-900 border-gray-600 ".concat(a," ").concat(!o&&"text-transparent"," hover:text-gray-200 cursor-pointer"),style:{minWidth:200},onClick:()=>c(t),children:[(0,l.jsx)("div",{className:"absolute p-1 ".concat(o&&"text-blue-600"),children:(0,l.jsx)(r,{mode:o})}),(0,l.jsx)("div",{className:"w-full p-3 px-4 text-gray-200",children:a})]},a)})}),null==n?void 0:n.map((e,n)=>{var r;return(0,l.jsx)("tr",{className:"hover:bg-gray-700 hover:text-gray-100",children:null==t?void 0:t.map(t=>{let{visible:n=!0,column_name:r}=t,i=null==e?void 0:e[r];return n&&(0,l.jsx)(s,{value:i},"".concat(a,"_").concat(o,"_").concat(r,"_").concat("object"==typeof i?JSON.stringify(i):i))})},null!==(r=null==e?void 0:e.id)&&void 0!==r?r:"col_".concat(n))})]})};i.defaultProps={tableData:[]};let c=e=>{var t;return Object.keys(null!==(t=null==e?void 0:e[0])&&void 0!==t?t:{}).map(e=>({column_name:e,data_type:"string"}))};var u=e=>{let{description:t,status:n,rows:a,loading:r,viewMode:o}=e;return r?(0,l.jsx)("h1",{children:"Loading..."}):"ERROR"==n?(0,l.jsx)("pre",{className:"overflow-y-auto bg-gray-700 p-2 text-red-200 font-mono",children:JSON.stringify(t,null,2)}):(0,l.jsx)("div",{className:"h-2/3 mb-9 w-full max-w-full overflow-auto",children:"table"===o&&a instanceof Array?(0,l.jsx)(i,{columnNames:c(a),tableData:a}):(0,l.jsx)("pre",{className:"overflow-y-auto bg-gray-700 p-2 text-gray-200 font-mono",children:JSON.stringify(a,null,2)})})},d=n(9361),h=n(6681),m=n(7114),x=n(7270),y=e=>{let{sql:t,setSql:n,post:r,loading:o}=e,s=(0,a.useRef)(!1),i=(0,x.Ik)();return(0,a.useEffect)(()=>{i&&i.editor.setTheme("vs-dark")},[i]),(0,l.jsx)(x.ZP,{height:"33vh",defaultLanguage:"sql",value:t,onChange:e=>n(e),onKeyDown:e=>{"Control"===e.key||"Meta"===e.key?s.current=!0:"Enter"===e.key&&s.current&&!o&&r()},onKeyUp:e=>{("Control"===e.key||"Meta"===e.key)&&(s.current=!1)},options:{fontFamily:"monospace",automaticLayout:!0},onMount:(e,t)=>{t.editor.defineTheme("custom-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#101827"}}),t.editor.setTheme("custom-dark"),e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.Enter,()=>{o||r()}),e.onKeyDown(e=>{(e.keyCode===t.KeyCode.Ctrl||e.keyCode===t.KeyCode.Meta)&&(s.current=!0)}),e.onKeyUp(e=>{(e.keyCode===t.KeyCode.Ctrl||e.keyCode===t.KeyCode.Meta)&&(s.current=!1)})}})},v=e=>{let{textToCopy:t}=e,[n,r]=(0,a.useState)(!1);return(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{onClick:()=>{let e="string"==typeof t?t:JSON.stringify(t,null,2);navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),2e3)},className:"p-2 hover:bg-gray-700 hover:text-gray-100","data-tip":!0,"data-for":"btn-copy-".concat(t),children:"\uD83D\uDCCB"}),(0,l.jsx)(o.Z,{id:"btn-copy-".concat(t),type:"info",children:(0,l.jsx)("span",{children:n?"Copied!":"Copy to Clipboard"})})]})};let p=e=>{if(!e)return"";let{size:t}=new Blob([JSON.stringify(e)]);return t>1026?"".concat(t/1026," kb"):"".concat(t," bytes")},g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e>3e4?"text-red-600":e<3e4&&e>1e4?"text-yellow-600":"text-green-600"};new d.Z("PG");var f=e=>{var t;let{session:n,selectedSql:r,activeTabId:s}=e,[i,c]=(0,a.useState)({status:"",description:null,rows:null,duration:0}),[d,x]=(0,a.useState)(!1),[f,b]=(0,a.useState)("SELECT NOW();"),[,S]=(0,h.mr)(),[w,j]=(0,a.useState)("table"),_=(0,a.useRef)(f);(0,a.useEffect)(()=>{r&&b(r)},[r]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{localStorage.setItem("sql_".concat(s),f)},500);return()=>clearTimeout(e)},[f]),(0,a.useEffect)(()=>{let e=localStorage.getItem("sql_".concat(s));e&&(b(e),c({status:"",description:null,rows:null,duration:0}))},[s]),(0,a.useEffect)(()=>{_.current=f},[f]);let N=(0,a.useCallback)(async()=>{let e=_.current;console.log("post",e),x(!0),n.executeSQL(e).then(t=>{if(x(!1),t.status){var n,l;console.log(t),c({description:null==t?void 0:t.description,status:null==t?void 0:t.status,rows:null!==(n=null==t?void 0:t.rows)&&void 0!==n?n:null,duration:null!==(l=null==t?void 0:t.duration)&&void 0!==l?l:0})}return S({type:"ADD_HISTORY",payload:{time:new Date,sql:e,uuid:(0,m.Wu)(e)}}),!0}).catch(e=>{x(!1),c({status:"ERROR",rows:[],description:"Failed to execute query, check your command is still running",duration:0}),console.error(e)})},[n,S]);return(0,l.jsxs)("div",{className:"flex flex-col p-4 h-full w-full bg-gray-800",children:[(0,l.jsx)(y,{sql:f,setSql:b,post:N,loading:d}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex flex-1 max-h-10 w-full justify-between text-gray-200",children:[(0,l.jsxs)("div",{className:"align-center text-xs px-2 pt-2",children:["Status:",(0,l.jsx)("span",{className:"px-2 ".concat((null==i?void 0:i.status)==="SUCCESS"&&"text-green-600"," ").concat((null==i?void 0:i.status)==="ERROR"&&"text-red-600"),children:null!==(t=null==i?void 0:i.status)&&void 0!==t?t:""}),"Time:",(0,l.jsx)("span",{className:"px-2 ".concat(g(null==i?void 0:i.duration)),children:(null==i?void 0:i.duration)?"".concat(null==i?void 0:i.duration," ms"):""}),(null==i?void 0:i.rows)!==null?(0,l.jsxs)(l.Fragment,{children:["Size:",(0,l.jsx)("span",{className:"px-2 ".concat((null==i?void 0:i.status)==="SUCCESS"&&"text-green-600"),children:(null==i?void 0:i.rows)!==null?p(null==i?void 0:i.rows):""})]}):null]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(v,{textToCopy:null==i?void 0:i.rows}),(0,l.jsx)("button",{onClick:()=>{j(e=>"table"===e?"json":"table")},className:"p-2 hover:bg-gray-700 hover:text-gray-100","data-tip":!0,"data-for":"btn-toggle-view",children:"table"===w?"{}":"\uD83D\uDCC4"}),(0,l.jsx)(o.Z,{id:"btn-toggle-view",type:"info",children:(0,l.jsxs)("span",{children:[" ","table"===w?"Show JSON":"Show Table"]})}),(0,l.jsx)("button",{onClick:N,type:"button",disabled:d,className:"p-2 hover:bg-gray-700 hover:text-gray-100 ".concat(d&&"cursor-wait"),"data-tip":!0,"data-for":"btn-run",children:d?(0,l.jsx)("span",{role:"img",className:"font-mono","aria-label":"run_icon",children:"⚡️"}):"Run"}),(0,l.jsx)(o.Z,{id:"btn-run",type:"info",children:(0,l.jsx)("span",{children:"Tip: Ctrl+ Enter to execute SQL"})})]})]}),(0,l.jsx)(u,{description:null==i?void 0:i.description,status:null==i?void 0:i.status,rows:null==i?void 0:i.rows,loading:d,viewMode:w})]})]})},b=()=>(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-x",children:[(0,l.jsx)("line",{x1:"9",y1:"3",x2:"3",y2:"9"}),(0,l.jsx)("line",{x1:"3",y1:"3",x2:"9",y2:"9"})]}),S=e=>{var t;let{setSelectedSql:n}=e,[r,o]=(0,h.mr)();return(0,a.useEffect)(()=>{if(localStorage){var e;let t=null==r?void 0:null===(e=r.history)||void 0===e?void 0:e.map(e=>({...e,time:new Date(e.time).toISOString()}));localStorage.setItem("SQL_HISTORY",JSON.stringify(t))}},[r.history]),(0,l.jsx)("ul",{className:"h-full overflow-auto p-2",children:null==r?void 0:null===(t=r.history)||void 0===t?void 0:t.map((e,t)=>(0,l.jsxs)("li",{className:"w-full text-left hover:bg-gray-700 flex",children:[(0,l.jsx)("button",{type:"button",className:"mr-2 p-1 text-red-600 hover:bg-red-800 hover:text-gray-50 rounded",onClick:()=>o({type:"REMOVE_HISTORY",payload:t}),children:(0,l.jsx)(b,{})}),(0,l.jsx)("button",{type:"button",className:"w-full text-left truncate",onClick:()=>n(null==e?void 0:e.sql),children:null==e?void 0:e.sql})]},null==e?void 0:e.uuid))})},w=e=>{let{title:t}=e;return(0,l.jsx)("h2",{className:"text-gray-400 pl-2 py-1 font-bold text-xs border-gray-400 border",children:t})},j=()=>{let[e,t]=(0,a.useState)([{id:1,title:"Query 1"}]),[n,r]=(0,a.useState)(1),[o,s]=(0,a.useState)(""),i=new d.Z("PG"),c=()=>{let n=e.length+1;t([...e,{id:n,title:"Query ".concat(n)}]),r(n)},u=n=>{let l=e.filter(e=>e.id!==n);t(l),l.length>0?r(l[0].id):c()};return(0,a.useEffect)(()=>{let e=localStorage.getItem("sql_".concat(n));null!==e?s(e):s("")},[n]),(0,l.jsxs)("div",{className:"flex w-full h-full text-gray-200",children:[(0,l.jsxs)("div",{className:"h-full bg-gray-800 w-1/5",style:{minWidth:"20%"},children:[(0,l.jsx)(w,{title:"Queries"}),(0,l.jsx)(S,{setSelectedSql:s})]}),(0,l.jsxs)("div",{className:"border-l border-gray-600 sql-dataview-wrapper w-full",children:[(0,l.jsxs)("div",{className:"tabs flex p-2",children:[e.map(e=>(0,l.jsxs)("button",{className:"tab px-4 py-2 ".concat(e.id===n?"bg-gray-700 text-white":"bg-gray-600 text-gray-300"),onClick:()=>r(e.id),children:[e.title,(0,l.jsx)("span",{onClick:t=>{t.stopPropagation(),u(e.id)},className:"ml-2 text-red-500 cursor-pointer",children:"x"})]},e.id)),(0,l.jsx)("button",{onClick:c,className:"px-4 py-2 bg-gray-600 text-gray-300",children:"+"})]}),(0,l.jsx)(f,{session:i,selectedSql:o,activeTabId:n})]})]})}},6681:function(e,t,n){n.d(t,{wI:function(){return c},mr:function(){return s}});var l=n(7437),a=n(2265);function r(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{history:[]},l=arguments.length>1?arguments[1]:void 0;switch(l.type){case"SET_SESSION":return{...n,session:l.payload};case"CLEAR_SESSION":return{...n,session:void 0};case"SET_HISTORY":return{...n,history:l.payload};case"ADD_HISTORY":{let t=null!==(e=n.history)&&void 0!==e?e:[],a=t.findIndex(e=>e.sql===l.payload.sql);if(-1===a)return{...n,history:[l.payload,...t]};{let e=t.map((e,t)=>t===a?{...e,time:new Date}:e);return{...n,history:e}}}case"REMOVE_HISTORY":let a=[...null!==(t=n.history)&&void 0!==t?t:[]];return null==a||a.splice(l.payload,1),{...n,history:a};case"CLEAR_HISTORY":return{...n,history:[]};default:return n}}let o=(0,a.createContext)({});function s(){return(0,a.useContext)(o)}let i=()=>{try{var e;return JSON.parse(null!==(e=localStorage.getItem("SQL_HISTORY"))&&void 0!==e?e:"[]")}catch(e){return[]}},c=e=>{let{children:t}=e,{Provider:n}=o,s=i();return(0,l.jsx)(n,{value:(0,a.useReducer)(r,{history:null!=s?s:[]}),children:t})}},7114:function(e,t,n){n.d(t,{Kq:function(){return r},Wu:function(){return l},ae:function(){return a}});let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=3735928559^t,l=1103547991^t;for(let t=0,a;t<e.length;t++)n=Math.imul(n^(a=e.charCodeAt(t)),2654435761),l=Math.imul(l^a,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(l^l>>>13,3266489909),4294967296*(2097151&(l=Math.imul(l^l>>>16,2246822507)^Math.imul(n^n>>>13,3266489909)))+(n>>>0)},a=e=>{let t=0,n=parseInt(e,10)||0;for(;n>=1024&&++t;)n/=1024;return"".concat(n.toFixed(n<10&&t>0?1:0)," ").concat(["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t])},r=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={BYTES:1,KB:1024,MB:1048576,GB:1073741824,TB:1099511627776,PB:0x4000000000000,EB:0x1000000000000000};return null!==(e=null==t?void 0:t.reduce((e,t)=>{let l;return e+parseFloat(l=t||"")*(n[null==l?void 0:l.match(/[a-zA-Z]+/)[0].toUpperCase()]||1)},0))&&void 0!==e?e:0}}}]);