"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[235],{9361:function(e,t,a){a.d(t,{Z:function(){return r}});let n=async(e,t)=>{let a=await fetch("http://localhost:3253/api/execute_pg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queries:e})});if(!a.ok)throw Error("Failed to execute query");return await a.json()};class l{constructor(e){this.executeSQL=e=>new Promise((t,a)=>{n([e],this.id).then(e=>{var n,l;(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n[0])?t(null==e?void 0:null===(l=e.data)||void 0===l?void 0:l[0]):a(Error("Failed to execute query"))}).catch(a)}),this.getDBSchemas=()=>new Promise((e,t)=>{this.executeSQL("SELECT schema_name\n      FROM information_schema.schemata\n      WHERE \"schema_name\" NOT LIKE 'pg_%' AND schema_name <> 'information_schema';").then(a=>(null==a?void 0:a.rows)&&Array.isArray(null==a?void 0:a.rows)?e(null==a?void 0:a.rows.filter(e=>!!(null==e?void 0:e.schema_name)).map(e=>e.schema_name)):t(Error("Failed to parse the schemas"))).catch(t)}),this.getErdData=()=>new Promise((e,t)=>{this.executeSQL("SELECT\n      tc.table_schema,\n      tc.constraint_name,\n      tc.table_name,\n      kcu.column_name,\n      ccu.table_schema AS foreign_table_schema,\n      ccu.table_name AS foreign_table_name,\n      ccu.column_name AS foreign_column_name\n  FROM\n      information_schema.table_constraints AS tc\n      JOIN information_schema.key_column_usage AS kcu\n        ON tc.constraint_name = kcu.constraint_name\n        AND tc.table_schema = kcu.table_schema\n      JOIN information_schema.constraint_column_usage AS ccu\n        ON ccu.constraint_name = tc.constraint_name\n        AND ccu.table_schema = tc.table_schema;\n  ").then(t=>(console.log(t),e(t))).catch(t)}),this.getAllTables=e=>new Promise((t,a)=>{this.executeSQL("SELECT * FROM information_schema.tables\n      WHERE table_schema = '".concat(e,"'")).then(e=>(null==e?void 0:e.rows)&&Array.isArray(null==e?void 0:e.rows)?t(null==e?void 0:e.rows.filter(e=>!!(null==e?void 0:e.table_name))):a(Error("Failed to parse the schemas"))).catch(a)}),this.getTableData=e=>{let{schema:t,table:a,pagenumber:n=1,size:l=50,sortedColumns:r}=e;return new Promise((e,o)=>{let s='SELECT * FROM "'.concat(t,'"."').concat(a,'" ');r&&(s+=" ORDER BY "+Object.entries(r).map(e=>{let[t,a]=e;return"".concat(t," ").concat(a)}).join(",")),s+=" LIMIT ".concat(l," OFFSET ").concat((n-1)*l,";"),this.executeSQL(s).then(t=>e(t)).catch(o)})},this.getColumnNames=e=>{let{schema:t,table:a}=e;return new Promise((e,n)=>{let l="SELECT\n      column_name,\n      data_type\n    FROM\n      INFORMATION_SCHEMA.COLUMNS\n    WHERE\n      TABLE_NAME = '".concat(a,"'\n      AND table_schema = '").concat(t,"';");this.executeSQL(l).then(t=>e(t)).catch(n)})},this.id=e}}var r=l},235:function(e,t,a){a.d(t,{Z:function(){return j}});var n=a(7437),l=a(2265);let r=e=>{let{mode:t="none"}=e;return(0,n.jsx)("svg",{"aria-hidden":"true",role:"img",className:"octicon octicon-filter",viewBox:"0 0 16 16",width:"10",height:"10",fill:"currentColor",style:{transform:"rotate(".concat("desc"===t?"0":"180","deg)")},children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M.75 3a.75.75 0 000 1.5h14.5a.75.75 0 000-1.5H.75zM3 7.75A.75.75 0 013.75 7h8.5a.75.75 0 010 1.5h-8.5A.75.75 0 013 7.75zm3 4a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5a.75.75 0 01-.75-.75z"})})};r.defaultProps={mode:"none"};var o=a(5576),s=l.memo(e=>{let t,a,{value:l}=e;return l instanceof Date?t=new Date(l).toLocaleString():"object"==typeof l?(a=JSON.stringify(l,null,2),t=JSON.stringify(l)):(t=l,"string"==typeof l&&(null==l?void 0:l.length)>20&&(a=l)),(0,n.jsxs)("td",{className:"border-l border-b border-gray-600 px-2 break-all truncate text-white",style:{maxWidth:100},children:[(0,n.jsx)("span",{"data-tip":!0,"data-for":"btn-run-".concat(l),children:null!=t?t:""}),a&&(0,n.jsx)(o.Z,{id:"btn-run-".concat(l),type:"dark",children:(0,n.jsx)("pre",{className:"font-mono",style:{height:"40%"},children:a})})]})});let i=e=>{let{columnNames:t=[],tableData:a=[],selectedSchema:l="",selectedTable:o="",onSort:i=console.warn}=e,c=e=>{let a;let n=t[e];a=(null==n?void 0:n.sort)?(null==n?void 0:n.sort)==="asc"?"desc":"none":"asc",i({[null==n?void 0:n.column_name]:a})};return(0,n.jsxs)("table",{className:"w-full border border-gray-600",children:[(0,n.jsx)("tr",{className:"bg-gray-900",children:null==t?void 0:t.map((e,t)=>{let{visible:a=!0,column_name:l="",sort:o}=e;return a&&(0,n.jsxs)("th",{className:"border bg-gray-900 border-gray-600 ".concat(l," ").concat(!o&&"text-transparent"," hover:text-gray-200 cursor-pointer"),style:{minWidth:200},onClick:()=>c(t),children:[(0,n.jsx)("div",{className:"absolute p-1 ".concat(o&&"text-blue-600"),children:(0,n.jsx)(r,{mode:o})}),(0,n.jsx)("div",{className:"w-full p-3 px-4 text-gray-200",children:l})]},l)})}),null==a?void 0:a.map((e,a)=>{var r;return(0,n.jsx)("tr",{className:"hover:bg-gray-700 hover:text-gray-100",children:null==t?void 0:t.map(t=>{let{visible:a=!0,column_name:r}=t,i=null==e?void 0:e[r];return a&&(0,n.jsx)(s,{value:i},"".concat(l,"_").concat(o,"_").concat(r,"_").concat("object"==typeof i?JSON.stringify(i):i))})},null!==(r=null==e?void 0:e.id)&&void 0!==r?r:"col_".concat(a))})]})};i.defaultProps={tableData:[]};let c=e=>{var t;return Object.keys(null!==(t=null==e?void 0:e[0])&&void 0!==t?t:{}).map(e=>({column_name:e,data_type:"string"}))};var u=e=>{let{description:t,status:a,rows:l,loading:r,viewMode:o}=e;return r?(0,n.jsx)("h1",{children:"Loading..."}):"ERROR"==a?(0,n.jsx)("pre",{className:"overflow-y-auto bg-gray-700 p-2 text-red-200 font-mono",children:JSON.stringify(t,null,2)}):(0,n.jsx)("div",{className:"h-2/3 mb-9 w-full max-w-full overflow-auto",children:"table"===o&&l instanceof Array?(0,n.jsx)(i,{columnNames:c(l),tableData:l}):(0,n.jsx)("pre",{className:"overflow-y-auto bg-gray-700 p-2 text-gray-200 font-mono",children:JSON.stringify(l,null,2)})})},d=a(9361),h=a(6681),m=a(7114),x=a(7270),g=e=>{let{sql:t,setSql:a,post:r,loading:o}=e,s=(0,l.useRef)(!1),i=(0,x.Ik)();return(0,l.useEffect)(()=>{i&&i.editor.setTheme("vs-dark")},[i]),(0,n.jsx)(x.ZP,{height:"33vh",defaultLanguage:"sql",value:t,onChange:e=>a(e),onKeyDown:e=>{"Control"===e.key||"Meta"===e.key?s.current=!0:"Enter"===e.key&&s.current&&!o&&r()},onKeyUp:e=>{("Control"===e.key||"Meta"===e.key)&&(s.current=!1)},options:{fontFamily:"monospace",automaticLayout:!0},onMount:(e,t)=>{t.editor.defineTheme("custom-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#101827"}}),t.editor.setTheme("custom-dark"),e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.Enter,()=>{o||r()}),e.onKeyDown(e=>{(e.keyCode===t.KeyCode.Ctrl||e.keyCode===t.KeyCode.Meta)&&(s.current=!0)}),e.onKeyUp(e=>{(e.keyCode===t.KeyCode.Ctrl||e.keyCode===t.KeyCode.Meta)&&(s.current=!1)})}})},v=e=>{let{textToCopy:t}=e,[a,r]=(0,l.useState)(!1);return(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{onClick:()=>{let e="string"==typeof t?t:JSON.stringify(t,null,2);navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),2e3)},className:"p-2 hover:bg-gray-700 hover:text-gray-100","data-tip":!0,"data-for":"btn-copy-".concat(t),children:"\uD83D\uDCCB"}),(0,n.jsx)(o.Z,{id:"btn-copy-".concat(t),type:"info",children:(0,n.jsx)("span",{children:a?"Copied!":"Copy to Clipboard"})})]})};let y=e=>{if(!e)return"";let{size:t}=new Blob([JSON.stringify(e)]);return t>1026?"".concat(t/1026," kb"):"".concat(t," bytes")},p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e>3e4?"text-red-600":e<3e4&&e>1e4?"text-yellow-600":"text-green-600"};new d.Z("PG");var f=e=>{var t;let{session:a,selectedSql:r,activeTabId:s}=e,[i,c]=(0,l.useState)({status:"",description:null,rows:null,duration:0}),[d,x]=(0,l.useState)(!1),[f,b]=(0,l.useState)("SELECT NOW();"),[,S]=(0,h.mr)(),[_,w]=(0,l.useState)("table"),j=(0,l.useRef)(f);(0,l.useEffect)(()=>{r&&b(r)},[r]),(0,l.useEffect)(()=>{let e=setTimeout(()=>{localStorage.setItem("sql_".concat(s),f)},500);return()=>clearTimeout(e)},[f]),(0,l.useEffect)(()=>{let e=localStorage.getItem("sql_".concat(s));e&&(b(e),c({status:"",description:null,rows:null,duration:0}))},[s]),(0,l.useEffect)(()=>{j.current=f},[f]);let N=(0,l.useCallback)(async()=>{let e=j.current;console.log("post",e),x(!0),a.executeSQL(e).then(t=>{if(x(!1),t.status){var a,n;console.log(t),c({description:null==t?void 0:t.description,status:null==t?void 0:t.status,rows:null!==(a=null==t?void 0:t.rows)&&void 0!==a?a:null,duration:null!==(n=null==t?void 0:t.duration)&&void 0!==n?n:0})}return"SUCCESS"===t.status&&S({type:"ADD_HISTORY",payload:{time:new Date,sql:e,uuid:(0,m.Wu)(e)}}),!0}).catch(e=>{x(!1),c({status:"ERROR",rows:[],description:"Failed to execute query, check your command is still running",duration:0}),console.error(e)})},[a,S]);return(0,n.jsxs)("div",{className:"flex flex-col pl-2 h-full w-full bg-gray-800",children:[(0,n.jsx)(g,{sql:f,setSql:b,post:N,loading:d}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex flex-1 max-h-10 w-full justify-between text-gray-200",children:[(0,n.jsxs)("div",{className:"align-center text-xs px-2 pt-2",children:["Status:",(0,n.jsx)("span",{className:"px-2 ".concat((null==i?void 0:i.status)==="SUCCESS"&&"text-green-600"," ").concat((null==i?void 0:i.status)==="ERROR"&&"text-red-600"),children:null!==(t=null==i?void 0:i.status)&&void 0!==t?t:""}),"Time:",(0,n.jsx)("span",{className:"px-2 ".concat(p(null==i?void 0:i.duration)),children:(null==i?void 0:i.duration)?"".concat(null==i?void 0:i.duration," ms"):""}),(null==i?void 0:i.rows)!==null?(0,n.jsxs)(n.Fragment,{children:["Size:",(0,n.jsx)("span",{className:"px-2 ".concat((null==i?void 0:i.status)==="SUCCESS"&&"text-green-600"),children:(null==i?void 0:i.rows)!==null?y(null==i?void 0:i.rows):""})]}):null]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(v,{textToCopy:null==i?void 0:i.rows}),(0,n.jsx)("button",{onClick:()=>{w(e=>"table"===e?"json":"table")},className:"p-2 hover:bg-gray-700 hover:text-gray-100","data-tip":!0,"data-for":"btn-toggle-view",children:"table"===_?"{}":"\uD83D\uDCC4"}),(0,n.jsx)(o.Z,{id:"btn-toggle-view",type:"info",children:(0,n.jsxs)("span",{children:[" ","table"===_?"Show JSON":"Show Table"]})}),(0,n.jsx)("button",{onClick:N,type:"button",disabled:d,className:"p-2 hover:bg-gray-700 hover:text-gray-100 ".concat(d&&"cursor-wait"),"data-tip":!0,"data-for":"btn-run",children:d?(0,n.jsx)("span",{role:"img",className:"font-mono","aria-label":"run_icon",children:"⚡️"}):"Run"}),(0,n.jsx)(o.Z,{id:"btn-run",type:"info",children:(0,n.jsx)("span",{children:"Tip: Ctrl+ Enter to execute SQL"})})]})]}),(0,n.jsx)(u,{description:null==i?void 0:i.description,status:null==i?void 0:i.status,rows:null==i?void 0:i.rows,loading:d,viewMode:_})]})]})},b=()=>(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-x",children:[(0,n.jsx)("line",{x1:"9",y1:"3",x2:"3",y2:"9"}),(0,n.jsx)("line",{x1:"3",y1:"3",x2:"9",y2:"9"})]}),S=e=>{var t;let{setSelectedSql:a}=e,[r,o]=(0,h.mr)();return(0,l.useEffect)(()=>{if(localStorage){var e;let t=null==r?void 0:null===(e=r.history)||void 0===e?void 0:e.map(e=>({...e,time:new Date(e.time).toISOString()}));localStorage.setItem("SQL_HISTORY",JSON.stringify(t))}},[r.history]),(0,n.jsx)("ul",{className:"h-full overflow-auto p-2","data-ph-no-capture":!0,children:null==r?void 0:null===(t=r.history)||void 0===t?void 0:t.map((e,t)=>(0,n.jsxs)("li",{className:"w-full text-left hover:bg-gray-700 flex",children:[(0,n.jsx)("button",{type:"button",className:"mr-2 p-1 text-red-600 hover:bg-red-800 hover:text-gray-50 rounded",onClick:()=>o({type:"REMOVE_HISTORY",payload:t}),children:(0,n.jsx)(b,{})}),(0,n.jsx)("button",{type:"button",className:"w-full text-left truncate",onClick:()=>a(null==e?void 0:e.sql),children:null==e?void 0:e.sql})]},null==e?void 0:e.uuid))})},_=e=>{let{title:t}=e;return(0,n.jsx)("h2",{className:"text-gray-400 pl-2 py-1 font-bold text-xs border-gray-400 border",children:t})},w=e=>{let{tabs:t,activeTabId:a,setActiveTabId:r,removeTab:o,addTab:s}=e,[i,c]=(0,l.useState)(null),u=e=>{c(e)},d=()=>{c(null)};return(0,n.jsxs)("div",{className:"tabs flex mx-2 mb-1 border border-gray-300",children:[t.map(e=>(0,n.jsx)("div",{className:"relative border-r",onMouseEnter:()=>u(e.id),onMouseLeave:d,children:(0,n.jsxs)("div",{className:e.id===a?"border-b-4 border-blue-500":"",children:[(0,n.jsx)("button",{className:"tab text-xs px-2 py-2 ".concat(e.id===a?"text-blue-500":"text-gray-500"),onClick:()=>r(e.id),children:e.title}),t.length>1&&(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),o(e.id)},className:"px-2 right-0 text-s text-gray-400 cursor-pointer hover:bg-slate-700",children:"x"})]})},e.id)),(0,n.jsx)("button",{onClick:s,className:"tab px-2 py-1 text-gray-500 hover:bg-slate-600",children:"+"})]})},j=()=>{let e=localStorage.getItem("sql_tabs")?JSON.parse(localStorage.getItem("sql_tabs")):[{id:1,title:"Query 1"}],t=parseInt(localStorage.getItem("sql_activeTabId"))||1,a=localStorage.getItem("sql_".concat(t))||"SELECT now();",[r,o]=(0,l.useState)(e),[s,i]=(0,l.useState)(t),[c,u]=(0,l.useState)(a),h=new d.Z("PG"),[m,x]=(0,l.useState)(e.length>0?Math.max(...e.map(e=>e.id)):1),g=()=>{let e=m+1,t=[...r,{id:e,title:"Query ".concat(e)}];o(t),i(e),x(e),localStorage.setItem("sql_tabs",JSON.stringify(t)),localStorage.setItem("sql_activeTabId",e.toString()),localStorage.setItem("sql_".concat(e),"SELECT now();"),u("SELECT now();")};return(0,l.useEffect)(()=>{r.some(e=>e.id===s)||i(r.length>0?r[0].id:1),localStorage.setItem("sql_tabs",JSON.stringify(r)),localStorage.setItem("sql_activeTabId",s.toString()),u(localStorage.getItem("sql_".concat(s))||"SELECT now();")},[r,s]),(0,n.jsxs)("div",{className:"flex w-full h-full text-gray-200",children:[(0,n.jsxs)("div",{className:"h-full bg-gray-800 w-1/5",style:{minWidth:"20%"},children:[(0,n.jsx)(_,{title:"Queries"}),(0,n.jsx)(S,{setSelectedSql:u})]}),(0,n.jsxs)("div",{className:"border-l border-gray-600 sql-dataview-wrapper w-full",children:[(0,n.jsx)(w,{tabs:r,activeTabId:s,setActiveTabId:i,removeTab:e=>{let t=r.filter(t=>t.id!==e);o(t),localStorage.setItem("sql_tabs",JSON.stringify(t)),localStorage.removeItem("sql_".concat(e)),e===s&&(t.length>0?(i(t[0].id),localStorage.setItem("sql_activeTabId",t[0].id.toString()),u(localStorage.getItem("sql_".concat(t[0].id))||"SELECT now();")):g())},addTab:g}),(0,n.jsx)(f,{session:h,selectedSql:c,activeTabId:s})]})]})}},6681:function(e,t,a){a.d(t,{wI:function(){return c},mr:function(){return s}});var n=a(7437),l=a(2265);function r(){var e,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{history:[]},n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SET_SESSION":return{...a,session:n.payload};case"CLEAR_SESSION":return{...a,session:void 0};case"SET_HISTORY":return{...a,history:n.payload};case"ADD_HISTORY":{let t=null!==(e=a.history)&&void 0!==e?e:[],l=t.findIndex(e=>e.sql===n.payload.sql);if(-1===l)return{...a,history:[n.payload,...t]};{let e=t.map((e,t)=>t===l?{...e,time:new Date}:e);return{...a,history:e}}}case"REMOVE_HISTORY":let l=[...null!==(t=a.history)&&void 0!==t?t:[]];return null==l||l.splice(n.payload,1),{...a,history:l};case"CLEAR_HISTORY":return{...a,history:[]};default:return a}}let o=(0,l.createContext)({});function s(){return(0,l.useContext)(o)}let i=()=>{try{var e;return JSON.parse(null!==(e=localStorage.getItem("SQL_HISTORY"))&&void 0!==e?e:"[]")}catch(e){return[]}},c=e=>{let{children:t}=e,{Provider:a}=o,s=i();return(0,n.jsx)(a,{value:(0,l.useReducer)(r,{history:null!=s?s:[]}),children:t})}},7114:function(e,t,a){a.d(t,{Kq:function(){return r},Wu:function(){return n},ae:function(){return l}});let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=3735928559^t,n=1103547991^t;for(let t=0,l;t<e.length;t++)a=Math.imul(a^(l=e.charCodeAt(t)),2654435761),n=Math.imul(n^l,1597334677);return a=Math.imul(a^a>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&(n=Math.imul(n^n>>>16,2246822507)^Math.imul(a^a>>>13,3266489909)))+(a>>>0)},l=e=>{let t=0,a=parseInt(e,10)||0;for(;a>=1024&&++t;)a/=1024;return"".concat(a.toFixed(a<10&&t>0?1:0)," ").concat(["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t])},r=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a={BYTES:1,KB:1024,MB:1048576,GB:1073741824,TB:1099511627776,PB:0x4000000000000,EB:0x1000000000000000};return null!==(e=null==t?void 0:t.reduce((e,t)=>{let n;return e+parseFloat(n=t||"")*(a[null==n?void 0:n.match(/[a-zA-Z]+/)[0].toUpperCase()]||1)},0))&&void 0!==e?e:0}}}]);