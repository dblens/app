"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[707],{56254:function(e,t,l){var a=l(57437);l(2265),t.Z=e=>{let{title:t}=e;return(0,a.jsx)("h2",{className:"text-gray-400 pl-2 py-1 font-bold text-xs border-gray-400 border",children:t})}},23242:function(e,t,l){l.d(t,{Z:function(){return c}});var a=l(57437),n=l(2265);let r=e=>{let{mode:t="none"}=e;return(0,a.jsx)("svg",{"aria-hidden":"true",role:"img",className:"octicon octicon-filter",viewBox:"0 0 16 16",width:"10",height:"10",fill:"currentColor",style:{transform:"rotate(".concat("desc"===t?"0":"180","deg)")},children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M.75 3a.75.75 0 000 1.5h14.5a.75.75 0 000-1.5H.75zM3 7.75A.75.75 0 013.75 7h8.5a.75.75 0 010 1.5h-8.5A.75.75 0 013 7.75zm3 4a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5a.75.75 0 01-.75-.75z"})})};r.defaultProps={mode:"none"};var o=l(95576),s=n.memo(e=>{let t,l,{value:n}=e;return n instanceof Date?t=new Date(n).toLocaleString():"object"==typeof n?(l=JSON.stringify(n,null,2),t=JSON.stringify(n)):(t=n,"string"==typeof n&&(null==n?void 0:n.length)>20&&(l=n)),(0,a.jsxs)("td",{className:"border-l border-b border-gray-600 px-2 break-all truncate text-white",style:{maxWidth:100},children:[(0,a.jsx)("span",{"data-tip":!0,"data-for":"btn-run-".concat(n),children:null!=t?t:""}),l&&(0,a.jsx)(o.Z,{id:"btn-run-".concat(n),type:"dark",children:(0,a.jsx)("pre",{className:"font-mono",style:{height:"40%"},children:l})})]})});let i=e=>{let{columnNames:t=[],tableData:l=[],selectedSchema:n="",selectedTable:o="",onSort:i=console.warn}=e,c=e=>{let l;let a=t[e];l=(null==a?void 0:a.sort)?(null==a?void 0:a.sort)==="asc"?"desc":"none":"asc",i({[null==a?void 0:a.column_name]:l})};return(0,a.jsx)("div",{className:"",children:(0,a.jsxs)("table",{className:"border border-gray-600 h-full w-full table-fixed overflow-x-scroll",children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{className:"bg-gray-900",children:null==t?void 0:t.map((e,t)=>{let{visible:l=!0,column_name:n="",sort:o}=e;return l&&(0,a.jsxs)("th",{className:"border bg-gray-900 border-gray-600 ".concat(n," ").concat(!o&&"text-transparent"," hover:text-gray-200 cursor-pointer"),style:{minWidth:200,width:200,position:"sticky",top:0,zIndex:10},onClick:()=>c(t),children:[(0,a.jsx)("div",{className:"relative p-1 ".concat(o?"text-blue-600":""),children:(0,a.jsx)(r,{mode:o})}),(0,a.jsx)("div",{className:"w-full p-3 px-4 text-gray-200",children:n})]},n)})})}),(0,a.jsx)("tbody",{children:null==l?void 0:l.map((e,l)=>{var r;return(0,a.jsx)("tr",{className:"hover:bg-gray-700 hover:text-gray-100",children:null==t?void 0:t.map(t=>{let{visible:l=!0,column_name:r}=t,i=null==e?void 0:e[r];return l&&(0,a.jsx)(s,{value:i},"".concat(n,"_").concat(o,"_").concat(r,"_").concat("object"==typeof i?JSON.stringify(i):i))})},null!==(r=null==e?void 0:e.id)&&void 0!==r?r:"col_".concat(l))})})]})})};i.defaultProps={tableData:[]};var c=i},29361:function(e,t,l){l.d(t,{Z:function(){return r}});let a=async(e,t)=>{let l=await fetch("http://localhost:3253/api/execute_pg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queries:e})});if(!l.ok)throw Error("Failed to execute query");return await l.json()};class n{constructor(e){this.executeSQL=e=>new Promise((t,l)=>{a([e],this.id).then(e=>{var a,n;(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a[0])?t(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n[0]):l(Error("Failed to execute query"))}).catch(l)}),this.getDBSchemas=()=>new Promise((e,t)=>{this.executeSQL("SELECT schema_name\n      FROM information_schema.schemata\n      WHERE \"schema_name\" NOT LIKE 'pg_%' AND schema_name <> 'information_schema';").then(l=>(null==l?void 0:l.rows)&&Array.isArray(null==l?void 0:l.rows)?e(null==l?void 0:l.rows.filter(e=>!!(null==e?void 0:e.schema_name)).map(e=>e.schema_name)):t(Error("Failed to parse the schemas"))).catch(t)}),this.getErdData=()=>new Promise((e,t)=>{this.executeSQL("SELECT\n      tc.table_schema,\n      tc.constraint_name,\n      tc.table_name,\n      kcu.column_name,\n      ccu.table_schema AS foreign_table_schema,\n      ccu.table_name AS foreign_table_name,\n      ccu.column_name AS foreign_column_name\n  FROM\n      information_schema.table_constraints AS tc\n      JOIN information_schema.key_column_usage AS kcu\n        ON tc.constraint_name = kcu.constraint_name\n        AND tc.table_schema = kcu.table_schema\n      JOIN information_schema.constraint_column_usage AS ccu\n        ON ccu.constraint_name = tc.constraint_name\n        AND ccu.table_schema = tc.table_schema;\n  ").then(t=>(console.log(t),e(t))).catch(t)}),this.getAllTables=e=>new Promise((t,l)=>{this.executeSQL("SELECT * FROM information_schema.tables\n      WHERE table_schema = '".concat(e,"'")).then(e=>(null==e?void 0:e.rows)&&Array.isArray(null==e?void 0:e.rows)?t(null==e?void 0:e.rows.filter(e=>!!(null==e?void 0:e.table_name))):l(Error("Failed to parse the schemas"))).catch(l)}),this.getTableData=e=>{let{schema:t,table:l,pagenumber:a=1,size:n=50,sortedColumns:r}=e;return new Promise((e,o)=>{let s='SELECT * FROM "'.concat(t,'"."').concat(l,'" ');r&&(s+=" ORDER BY "+Object.entries(r).map(e=>{let[t,l]=e;return"".concat(t," ").concat(l)}).join(",")),s+=" LIMIT ".concat(n," OFFSET ").concat((a-1)*n,";"),this.executeSQL(s).then(t=>e(t)).catch(o)})},this.getColumnNames=e=>{let{schema:t,table:l}=e;return new Promise((e,a)=>{let n="SELECT\n      column_name,\n      data_type\n    FROM\n      INFORMATION_SCHEMA.COLUMNS\n    WHERE\n      TABLE_NAME = '".concat(l,"'\n      AND table_schema = '").concat(t,"';");this.executeSQL(n).then(t=>e(t)).catch(a)})},this.id=e}}var r=n},29707:function(e,t,l){l.d(t,{Z:function(){return E}});var a=l(57437),n=l(2265),r=l(16463),o=l(23242);let s=e=>{var t;return Object.keys(null!==(t=null==e?void 0:e[0])&&void 0!==t?t:{}).map(e=>({column_name:e,data_type:"string"}))},i=e=>{let{code:t,mode:l="code"}=e;return(0,a.jsx)("pre",{className:"overflow-auto bg-gray-700 p-2 font-mono max-w-2/3 ".concat("error"==t?"text-red-200":"text-gray-200"),style:{maxWidth:"100%"},children:JSON.stringify(t,null,2)})};var c=e=>{let{description:t,status:l,rows:n,loading:r,viewMode:c}=e;return r?(0,a.jsx)("h1",{children:"Loading..."}):"ERROR"==l?(0,a.jsx)(i,{mode:"error",code:t}):(0,a.jsx)("div",{className:"h-2/3 w-full max-w-full overflow-auto overflow-x-scroll",style:{height:"inherit"},children:"table"===c&&n instanceof Array?(0,a.jsx)(o.Z,{columnNames:s(n),tableData:n}):(0,a.jsx)(i,{code:n})})},u=l(29361),d=l(95576),h=l(96681),m=l(57114),x=l(37270),v=e=>{let{sql:t,setSql:l,post:r,loading:o}=e,s=(0,n.useRef)(!1),i=(0,x.Ik)();return(0,n.useEffect)(()=>{i&&i.editor.setTheme("vs-dark")},[i]),(0,a.jsx)(x.ZP,{defaultLanguage:"sql",value:t,onChange:e=>l(e),onKeyDown:e=>{"Control"===e.key||"Meta"===e.key?s.current=!0:"Enter"===e.key&&s.current&&!o&&r()},onKeyUp:e=>{("Control"===e.key||"Meta"===e.key)&&(s.current=!1)},options:{fontFamily:"monospace",automaticLayout:!0},onMount:(e,t)=>{t.editor.defineTheme("custom-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#101827"}}),t.editor.setTheme("custom-dark"),e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.Enter,()=>{o||r()}),e.onKeyDown(e=>{(e.keyCode===t.KeyCode.Ctrl||e.keyCode===t.KeyCode.Meta)&&(s.current=!0)}),e.onKeyUp(e=>{(e.keyCode===t.KeyCode.Ctrl||e.keyCode===t.KeyCode.Meta)&&(s.current=!1)})}})},g=e=>{let{textToCopy:t}=e,[l,r]=(0,n.useState)(!1);return(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{onClick:()=>{let e="string"==typeof t?t:JSON.stringify(t,null,2);navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),2e3)},className:"p-2 hover:bg-gray-700 hover:text-gray-100","data-tip":!0,"data-for":"btn-copy-".concat(t),children:"\uD83D\uDCCB"}),(0,a.jsx)(d.Z,{id:"btn-copy-".concat(t),type:"info",children:(0,a.jsx)("span",{children:l?"Copied!":"Copy to Clipboard"})})]})};let y=e=>{if(!e)return"";let{size:t}=new Blob([JSON.stringify(e)]);return t>1026?"".concat(t/1026," kb"):"".concat(t," bytes")},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e>3e4?"text-red-600":e<3e4&&e>1e4?"text-yellow-600":"text-green-600"};new u.Z("PG");var p=e=>{var t;let{session:l,selectedSql:r,activeTabId:o}=e,[s,i]=(0,n.useState)({status:"",description:null,rows:null,duration:0}),[u,x]=(0,n.useState)(!1),[p,b]=(0,n.useState)("SELECT NOW();"),[,S]=(0,h.mr)(),[w,_]=(0,n.useState)("table"),j=(0,n.useRef)(p);(0,n.useEffect)(()=>{r&&b(r)},[r]),(0,n.useEffect)(()=>{let e=setTimeout(()=>{localStorage.setItem("sql_".concat(o),p)},500);return()=>clearTimeout(e)},[p]),(0,n.useEffect)(()=>{let e=localStorage.getItem("sql_".concat(o));e&&(b(e),i({status:"",description:null,rows:null,duration:0}))},[o]),(0,n.useEffect)(()=>{j.current=p},[p]);let N=(0,n.useCallback)(async()=>{let e=j.current;console.log("post",e),x(!0),l.executeSQL(e).then(t=>{if(x(!1),t.status){var l,a;console.log(t),i({description:null==t?void 0:t.description,status:null==t?void 0:t.status,rows:null!==(l=null==t?void 0:t.rows)&&void 0!==l?l:null,duration:null!==(a=null==t?void 0:t.duration)&&void 0!==a?a:0})}return"SUCCESS"===t.status&&S({type:"ADD_HISTORY",payload:{time:new Date,sql:e,uuid:(0,m.Wu)(e)}}),!0}).catch(e=>{x(!1),i({status:"ERROR",rows:[],description:"Failed to execute query, check your command is still running",duration:0}),console.error(e)})},[l,S]);return(0,a.jsxs)("div",{className:"flex flex-col pl-2 h-full w-full bg-gray-800 max-h-full",children:[(0,a.jsx)("div",{className:"h-1/3",children:(0,a.jsx)(v,{sql:p,setSql:b,post:N,loading:u})}),(0,a.jsxs)("div",{className:"h-2/3",children:[(0,a.jsxs)("div",{className:"flex flex-1 max-h-10 w-full justify-between text-gray-200",children:[(0,a.jsxs)("div",{className:"align-center text-xs px-2 pt-2",children:["Status:",(0,a.jsx)("span",{className:"px-2 ".concat((null==s?void 0:s.status)==="SUCCESS"&&"text-green-600"," ").concat((null==s?void 0:s.status)==="ERROR"&&"text-red-600"),children:null!==(t=null==s?void 0:s.status)&&void 0!==t?t:""}),"Time:",(0,a.jsx)("span",{className:"px-2 ".concat(f(null==s?void 0:s.duration)),children:(null==s?void 0:s.duration)?"".concat(null==s?void 0:s.duration," ms"):""}),(null==s?void 0:s.rows)!==null?(0,a.jsxs)(a.Fragment,{children:["Size:",(0,a.jsx)("span",{className:"px-2 ".concat((null==s?void 0:s.status)==="SUCCESS"&&"text-green-600"),children:(null==s?void 0:s.rows)!==null?y(null==s?void 0:s.rows):""})]}):null]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g,{textToCopy:null==s?void 0:s.rows}),(0,a.jsx)("button",{onClick:()=>{_(e=>"table"===e?"json":"table")},className:"p-2 hover:bg-gray-700 hover:text-gray-100","data-tip":!0,"data-for":"btn-toggle-view",children:"table"===w?"{}":"\uD83D\uDCC4"}),(0,a.jsx)(d.Z,{id:"btn-toggle-view",type:"info",children:(0,a.jsxs)("span",{children:[" ","table"===w?"Show JSON":"Show Table"]})}),(0,a.jsx)("button",{onClick:N,type:"button",disabled:u,className:"p-2 hover:bg-gray-700 hover:text-gray-100 ".concat(u&&"cursor-wait"),"data-tip":!0,"data-for":"btn-run",children:u?(0,a.jsx)("span",{role:"img",className:"font-mono","aria-label":"run_icon",children:"⚡️"}):"Run"}),(0,a.jsx)(d.Z,{id:"btn-run",type:"info",children:(0,a.jsx)("span",{children:"Tip: Ctrl+ Enter to execute SQL"})})]})]}),(0,a.jsx)(c,{description:null==s?void 0:s.description,status:null==s?void 0:s.status,rows:null==s?void 0:s.rows,loading:u,viewMode:w})]})]})},b=()=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-x",children:[(0,a.jsx)("line",{x1:"9",y1:"3",x2:"3",y2:"9"}),(0,a.jsx)("line",{x1:"3",y1:"3",x2:"9",y2:"9"})]}),S=e=>{var t;let{setSelectedSql:l}=e,[r,o]=(0,h.mr)();return(0,n.useEffect)(()=>{if(localStorage){var e;let t=null==r?void 0:null===(e=r.history)||void 0===e?void 0:e.map(e=>({...e,time:new Date(e.time).toISOString()}));localStorage.setItem("SQL_HISTORY",JSON.stringify(t))}},[r.history]),(0,a.jsx)("ul",{className:"h-full overflow-auto p-2","data-ph-no-capture":!0,children:null==r?void 0:null===(t=r.history)||void 0===t?void 0:t.map((e,t)=>(0,a.jsxs)("li",{className:"w-full text-left hover:bg-gray-700 flex",children:[(0,a.jsx)("button",{type:"button",className:"mr-2 p-1 text-red-600 hover:bg-red-800 hover:text-gray-50 rounded",onClick:()=>o({type:"REMOVE_HISTORY",payload:t}),children:(0,a.jsx)(b,{})}),(0,a.jsx)("button",{type:"button",className:"w-full text-left truncate",onClick:()=>l(null==e?void 0:e.sql),children:null==e?void 0:e.sql})]},null==e?void 0:e.uuid))})},w=l(56254),_=e=>{let{tabs:t,activeTabId:l,setActiveTabId:r,removeTab:o,addTab:s}=e,[i,c]=(0,n.useState)(null),u=e=>{c(e)},d=()=>{c(null)};return(0,a.jsxs)("div",{className:"tabs flex mx-2 border border-gray-300",children:[t.map(e=>(0,a.jsx)("div",{className:"relative border-r",onMouseEnter:()=>u(e.id),onMouseLeave:d,children:(0,a.jsxs)("div",{className:e.id===l?"border-b-4 border-blue-500":"",children:[(0,a.jsx)("button",{className:"tab text-xs px-2 py-2 ".concat(e.id===l?"text-blue-500":"text-gray-500"),onClick:()=>r(e.id),children:e.title}),t.length>1&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),o(e.id)},className:"px-2 right-0 text-s text-gray-400 cursor-pointer hover:bg-slate-700",children:"x"})]})},e.id)),(0,a.jsx)("button",{onClick:s,className:"tab px-2 py-1 text-gray-500 hover:bg-slate-600",children:"+"})]})},j=l(57818);let N=()=>{let e=(0,r.useRouter)(),t=(0,r.useSearchParams)(),l=localStorage.getItem("sql_tabs")?JSON.parse(localStorage.getItem("sql_tabs")):[{id:1,title:"Query 1"}],o=parseInt(localStorage.getItem("sql_activeTabId"))||1,s=localStorage.getItem("sql_".concat(o))||"SELECT now();",[i,c]=(0,n.useState)(l),[d,h]=(0,n.useState)(o),[m,x]=(0,n.useState)(s),v=new u.Z("PG"),[g,y]=(0,n.useState)(l.length>0?Math.max(...l.map(e=>e.id)):1),f=()=>{let e=g+1,t=[...i,{id:e,title:"Query ".concat(e)}];c(t),h(e),y(e),localStorage.setItem("sql_tabs",JSON.stringify(t)),localStorage.setItem("sql_activeTabId",e.toString()),localStorage.setItem("sql_".concat(e),"SELECT now();"),x("SELECT now();")};return(0,n.useEffect)(()=>{i.some(e=>e.id===d)||h(i.length>0?i[0].id:1),localStorage.setItem("sql_tabs",JSON.stringify(i)),localStorage.setItem("sql_activeTabId",d.toString()),x(localStorage.getItem("sql_".concat(d))||"SELECT now();")},[i,d]),(0,n.useEffect)(()=>{let l=null==t?void 0:t.get("sql");if(l){x(decodeURIComponent(l));{let t=new URL(window.location.href);t.searchParams.delete("sql"),e.replace(t.toString())}}},[t,e]),(0,a.jsxs)("div",{className:"flex w-full h-full text-gray-200",children:[(0,a.jsxs)("div",{className:"h-full bg-gray-800 w-1/5",style:{minWidth:"20%"},children:[(0,a.jsx)(w.Z,{title:"Queries"}),(0,a.jsx)(S,{setSelectedSql:x})]}),(0,a.jsxs)("div",{className:"border-l border-gray-600 sql-dataview-wrapper w-4/5",children:[(0,a.jsx)(_,{tabs:i,activeTabId:d,setActiveTabId:h,removeTab:e=>{let t=i.filter(t=>t.id!==e);c(t),localStorage.setItem("sql_tabs",JSON.stringify(t)),localStorage.removeItem("sql_".concat(e)),e===d&&(t.length>0?(h(t[0].id),localStorage.setItem("sql_activeTabId",t[0].id.toString()),x(localStorage.getItem("sql_".concat(t[0].id))||"SELECT now();")):f())},addTab:f}),(0,a.jsx)(p,{session:v,selectedSql:m,activeTabId:d})]})]})};var E=(0,j.default)(()=>Promise.resolve(N),{ssr:!1})},96681:function(e,t,l){l.d(t,{wI:function(){return c},mr:function(){return s}});var a=l(57437),n=l(2265);function r(){var e,t;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{history:[]},a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"SET_SESSION":return{...l,session:a.payload};case"CLEAR_SESSION":return{...l,session:void 0};case"SET_HISTORY":return{...l,history:a.payload};case"ADD_HISTORY":{let t=null!==(e=l.history)&&void 0!==e?e:[],n=t.findIndex(e=>e.sql===a.payload.sql);if(-1===n)return{...l,history:[a.payload,...t]};{let e=t.map((e,t)=>t===n?{...e,time:new Date}:e);return{...l,history:e}}}case"REMOVE_HISTORY":let n=[...null!==(t=l.history)&&void 0!==t?t:[]];return null==n||n.splice(a.payload,1),{...l,history:n};case"CLEAR_HISTORY":return{...l,history:[]};default:return l}}let o=(0,n.createContext)({});function s(){return(0,n.useContext)(o)}let i=()=>{try{var e;return JSON.parse(null!==(e=localStorage.getItem("SQL_HISTORY"))&&void 0!==e?e:"[]")}catch(e){return[]}},c=e=>{let{children:t}=e,{Provider:l}=o,s=i();return(0,a.jsx)(l,{value:(0,n.useReducer)(r,{history:null!=s?s:[]}),children:t})}},57114:function(e,t,l){l.d(t,{Kq:function(){return r},Wu:function(){return a},ae:function(){return n}});let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=3735928559^t,a=1103547991^t;for(let t=0,n;t<e.length;t++)l=Math.imul(l^(n=e.charCodeAt(t)),2654435761),a=Math.imul(a^n,1597334677);return l=Math.imul(l^l>>>16,2246822507)^Math.imul(a^a>>>13,3266489909),4294967296*(2097151&(a=Math.imul(a^a>>>16,2246822507)^Math.imul(l^l>>>13,3266489909)))+(l>>>0)},n=e=>{let t=0,l=parseInt(e,10)||0;for(;l>=1024&&++t;)l/=1024;return"".concat(l.toFixed(l<10&&t>0?1:0)," ").concat(["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t])},r=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l={BYTES:1,KB:1024,MB:1048576,GB:1073741824,TB:1099511627776,PB:0x4000000000000,EB:0x1000000000000000};return null!==(e=null==t?void 0:t.reduce((e,t)=>{let a;return e+parseFloat(a=t||"")*(l[null==a?void 0:a.match(/[a-zA-Z]+/)[0].toUpperCase()]||1)},0))&&void 0!==e?e:0}}}]);